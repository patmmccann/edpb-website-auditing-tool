<mat-expansion-panel expanded="true">
  <mat-expansion-panel-header>
    <mat-panel-title>
      @if(tag){
        <h2>{{ "analyses.edit.scenario_header" | translate }} {{tag.name}}</h2>
      }@else if(analysis) {
        <h2>{{ "analyses.edit.global_header" | translate }} {{analysis.name}}</h2>
      }
    </mat-panel-title>
  </mat-expansion-panel-header>
  <app-evaluations [card]="card" (evaluationEvent)="evaluationChange($event)" [evaluation]="evaluation">
  </app-evaluations>

  <h3>{{ "analyses.edit.summary" | translate }}</h3>

  @if(tag){
  @if(analysis && all_cards.length>0){
  <table matSort (matSortChange)="sortCardData($event)" style="width: 100%">
    <colgroup>
      <col span="1" style="width: 40%;">
      <col span="1" style="width: 40%;text-align:center;">
      <col span="1" style="width: 20%;text-align:center;">
    </colgroup>
    <thead>
      <tr>
        <th mat-sort-header="name">{{ "knowledge.name" | translate }} </th>
        <th mat-sort-header="evaluation">{{ "analyses.edit.evaluation" | translate }} </th>
        <th>{{ "analyses.edit.manage" | translate }} </th>
      </tr>
    </thead>
    <tbody>
      @for (card of all_cards; track card.card.id) {
      <tr>
        <td (click)="scroll(card.card)" class="truncate">{{card.card.name}}</td>
        <td class="truncate">
          @if(card.evaluation){
            @switch (card.evaluation.status) {
              @case ("compliant") {
                <i style="color: green;"> {{ "analyses.evaluation.compliant" | translate }} </i>
              }
              @case ("not_compliant") {
                <i style="color: red;"> {{ "analyses.evaluation.not_compliant" | translate }} </i>
              }
              @case ("TBD") {
                <i style="color: #004494;"> {{ "analyses.evaluation.TBD" | translate }}</i>
              }
            }
          }
        </td>
        <td>
          <a href="javascript:void(0)" (click)="scroll(card.card)">
            <mat-icon class="action-icon" aria-hidden="false" aria-label="view icon">edit</mat-icon>
          </a>
          <a *ngIf="browserService.use_electron"
            [routerLink]="['/report', analysis.id, 'tag', tag.id, 'card', card.card.id]">
            <mat-icon class="action-icon" aria-hidden="false" aria-label="report icon">description</mat-icon>
          </a>
          <a href="javascript:void(0)" (click)="deleteCard(card.card)">
            <mat-icon class="action-icon" aria-hidden="false" aria-label="delete icon">delete</mat-icon>
          </a>
        </td>
      </tr>
      }


    </tbody>

  </table>
  }
  }@else {
  @if(analysis && all_tags.length>0){
  <table matSort (matSortChange)="sortTagData($event)" style="width: 100%">
    <colgroup>
      <col span="1" style="width: 40%;">
      <col span="1" style="width: 40%;">
      <col span="1" style="width: 20%;text-align:center;">
    </colgroup>
    <thead>
      <tr>
        <th mat-sort-header="scenario">{{ "analyses.edit.scenario" | translate }} </th>
        <th mat-sort-header="evaluation">{{ "analyses.edit.evaluation" | translate }} </th>
        <th>{{ "analyses.edit.manage" | translate }}</th>
      </tr>
    </thead>
    <tbody>
      @for (tag of all_tags; track tag.tag.id) {
        <tr>
          <td (click)="router.navigate(['/analysis', analysis.id, 'tag', tag.tag.id])" class="truncate">{{tag.tag.name}}
          </td>
          <td class="truncate">
            @if(tag.evaluation){
              @switch (tag.evaluation.status) {
                @case ("compliant") {
                  <i style="color: green;"> {{ "analyses.evaluation.compliant" | translate }} </i>
                }
                @case ("not_compliant") {
                  <i style="color: red;"> {{ "analyses.evaluation.not_compliant" | translate }} </i>
                }
                @case ("TBD") {
                  <i style="color: #004494;"> {{ "analyses.evaluation.TBD" | translate }}</i>
                }
              }
            }
          </td>
          <td>
            <a [routerLink]="['/analysis', analysis.id, 'tag', tag.tag.id]">
              <mat-icon class="action-icon" aria-hidden="false" aria-label="view icon">edit</mat-icon>
            </a>
            <a *ngIf="browserService.use_electron" [routerLink]="['/report', analysis.id, 'tag', tag.tag.id]">
              <mat-icon class="action-icon" aria-hidden="false" aria-label="report icon">description</mat-icon>
            </a>
            <a href="javascript:void(0)" (click)="deleteTag(tag.tag)">
              <mat-icon class="action-icon" aria-hidden="false" aria-label="delete icon">delete</mat-icon>
            </a>
          </td>
        </tr>
      }
    </tbody>
  </table>
  }
  }
</mat-expansion-panel>